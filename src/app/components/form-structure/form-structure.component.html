<!-- ðŸ”¹ Xintra Card Wrapper -->
<div
  class=" border border-defaultborder rounded-xl shadow-sm bg-white dark:bg-bodybg builder-container"
>
  <div
    class="header flex flex-wrap items-center justify-between gap-1 px-1 py-2 border-b border-defaultborder"
  >
    <h2 class="text-base font-semibold text-defaulttextcolor">Form Builder</h2>

    <!-- ðŸ§© Field Palette (Drag Source) -->
    <div
      class="flex gap-2 flex-wrap"
      cdkDropList
      id="fieldPalette"
      [cdkDropListData]="availableFields"
      [cdkDropListConnectedTo]="['canvasZone']"
    >
      <div
        *ngFor="let field of availableFields"
        class="btn btn-outline-primary btn-sm select-none"
        cdkDrag
        [cdkDragData]="field"
      >
        {{ field.label }}
      </div>
    </div>

    <button
      class="btn btn-outline-danger btn-sm"
      type="button"
      (click)="clearCanvas()"
    >
      Clear Canvas
    </button>
  </div>

  <div class=" p-4">
    <!-- ðŸ”¸ Canvas Area (Now reorderable) -->
    <div
      class="canvas border border-defaultborder rounded-lg p-4 bg-bodybg2 dark:bg-bodybg"
      cdkDropList
      id="canvasZone"
      [cdkDropListData]="droppedFields"
      [cdkDropListConnectedTo]="['fieldPalette']"
      (cdkDropListDropped)="onDrop($event)"
    >
      <div *ngIf="!droppedFields.length" class="italic text-mutedtextcolor">
        No fields added yet. Drag a field type above to add one.
      </div>

      <!-- ðŸ”¹ Each field can be reordered -->
      <div
        *ngFor="let field of droppedFields; let i = index"
        class="canvas-field relative mb-4  rounded-md p-3 bg-gray-50 dark:bg-bodybg2 shadow-sm cursor-move"
        cdkDrag
      >
        <!-- ðŸ—‘ï¸ Delete Button -->
        <button
          type="button"
          class="absolute top-2 right-2 text-xs text-white bg-red-500 hover:bg-red-600 rounded-full w-5 h-5 flex items-center justify-center"
          (click)="deleteField(i)"
        >
          Ã—
        </button>

        <label class="block text-sm font-medium mb-2 text-defaulttextcolor">
          
        </label>

        <!-- ðŸ”¸ Render Field by Type -->
        <ng-container [ngSwitch]="field.type">

          <!-- ðŸ“ Text -->
          <input
            *ngSwitchCase="'text'"
            type="text"
            placeholder="Enter text"
            class="form-input w-full"
          />

          <!-- ðŸ”½ Dropdown -->
          <select *ngSwitchCase="'dropdown'" class="form-select w-full">
            <option *ngFor="let opt of field.options">{{ opt }}</option>
          </select>

          <!-- â˜‘ï¸ Checkbox -->
          <div *ngSwitchCase="'checkbox'" class="flex items-center gap-2">
            <input type="checkbox" class="form-checkbox" />
            <span>Check me</span>
          </div>

          <!-- ðŸ“Š Handsontable Grid -->
          <div *ngSwitchCase="'handsontable'" class="border rounded-md overflow-hidden">
            <app-handsontable></app-handsontable>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
